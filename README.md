# api_sp1_bot
- **Название проекта**  

    Проверка статуса выполненных домашних работ

- **Какую задачу решает ваш проект?**

    Во время учебы студенты яндекс.практикума сдают выполненные проекты на проверку. На проверку работы отводятся сутки, и неизвестно когда именно в течении этих суток работу проверят. Как правило, с первого раза сдать проект не удается - находятся недочеты. Студенту важно как можно раньше узнать, что его работу проверили и начать вносить исправления. 
    Данный бот опрашивает API яндекс.практикума один раз в 20мин (время можно менять), и в случае изменения статуса домашней работы, высылает сообщение на телеграм.
    Внеся небольшие изменения, можно доработать бот на оповещение о наступлении интересующего события на другом сайте.

- **Распишите языки программирования и фреймворки, а также технологии, которые вы использовали в рамках создания проекта и для чего**

    Бот написан на python в среде Windows Subsystem for Linux - позволяет работать с терминалом linux в windows. Используемый редактор - Visual Studio Code.
    Для отправки сообщений на телеграм, бот работает с Telegram API через через библиотеку python-telegram-bot. Сообщения отправляются через прокси. Список прокси-адресов получаю динамически, посредством парсинга сайта http://spys.one/socks/. Для парсинга сайта использую Selenium, так как на странице для отображения портов IP-адресов используется javascript. Если применять lxml или beatifulsoup, то вместо портов - набор символов. Если прокси из списка устарели, а новый список по каким-либо причинам получить не удается, через Twilio отсылается смс-сообщение на телефон с описанием ошибки. При этом бот переключается на работу без прокси, так как он задеплоен на Heroku, а Heroku может работать с телеграм без использования прокси. Функциональность с прокси избыточна, добавил, так как интересно было реализовать. В любой момент использование прокси можно отключить в config vars в heroku.

- **Продемонстрируйте работу проекта**

    - Запишите небольшое видео работы приложения в формате записи экрана. Желательно с комментариями в рамках видео.
    Ссылка на видео
    https://yadi.sk/i/LWBk5OOa-cnzfw

- **Распишите кратко по шагам процесс работы программы.**
    
    - Бот задеплоен на веб-сервере heroku, работает непрерывно и каждые 20мин отправляет запрос к API 
    яндекс.практикума. 
    - Если в этот 20 минутный интервал происходит изменение статуса домашней работы, осуществляется попытка отправить сообщение с новым статусом на телеграм.
    - Для отправки сообщения бот забирает свежие прокси с сайта http://spys.one/socks/. После парсинга страницы, IP-адреса вырезаются из полученного контента и формируются в список. 
    - Бот поочереди проверяет прокси из списка и пытается отправить сообщение на телеграм. В моем видео показано, что много прокси, даже только что полученные с сайта, уже не работают и отбрасываются. Если список с прокси закончился, а сообщение отправить не удалось, бот собирает новый список с сайта.(такое поведение пришлось проверять вручную, так как списка всегда хватало. Какой-нибудь прокси все равно оказывался рабочим) Если все прокси из списка нерабочие и неудается загрузить с сайта новый, бот отправляет смс-сообщение через Twilio и переключается на работу без прокси (я очень хочу узнать результаты домашней работы:))
    - После успешной отправки сообщения, бот засыпает на 20мин.

- **Как запустить вашу программу?**
    - !!! представленная версия бота предназначена только для деплоя на heroku и работе на windows10 в подсистеме WSL. Связано это с тем, что необходимый для работы Selenium требует запуска браузера, пусть даже в --headless режиме. Соответственно необходима установка в моем случае Google Chrome и Cromedriver. В зависимости от системы, пути установки различаются. Данный бот будет корректно работать на heroku и виндоус с WSL. (при старте определит, откуда запускается, и соответствующим образом изменит пути к Google Chrome и Cromedriver)
    - Для установки на windows10 с подсистемой WSL скачайте и установите Google Chrome, скачайте сromedriver.exe версии 80.0.3987.106. Переименуйте сromedriver.exe в сromedriver и переместите в /usr/local/bin/. После этого запустите файл homework_with_dynamic_proxy.py
    - для запуска на heroku нужно задеплоить проект, добавить следующие buildpacks https://skr.sh/s1e2jJR0KhU?a , добавить ваши токены в config vars https://prnt.sc/rxz0vg , после чего запустить проект.
